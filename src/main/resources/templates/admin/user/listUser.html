<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
            crossorigin="anonymous"></script>
    <meta charset="UTF-8">
    <title>USER</title>
</head>
<body>
<h3>List User</h3>
<button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#create_modals">
    Create
</button>
<table id="userList" border="1px" style="width: 70%">
<tr>
    <th>User Name</th>
    <th>Pass World</th>
    <th>Full Name</th>
    <th>Email</th>
    <th>Phone Number</th>

</tr>
<tr th:each="user:${users}">
<td th:text="${user.username}"></td>
<td th:text="${user.password}"></td>
<td th:text="${user.fullName}"></td>
<td th:text="${user.email}"></td>
<td th:text="${user.phoneNumber}"></td>
<td>
    <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#updateModal"
            th:id="${user.id}" onclick="update(this.id)">
        Edit
    </button>

</td>
    <td>
        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#delete_Modal"
                th:id="${user.id}" onclick="deleteUser(this.id)">
            Delete
        </button>
    </td>
</tr>
</table>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script type="text/javascript">
   function createUser(){
       let username=$('#name_create').val()
       let password=$('#password_create').val()
       let fullName=$('#fullName_create').val()
       let email=$('#email_create').val()
       let phoneNumber=$('#phoneNumber_create').val()
       let newUser={
           username:username,
           password:password,
           fullName:fullName,
           email:email,
           phoneNumber:phoneNumber
       };
       $.ajax({
           headers:{
               'Accept': 'application/json',
               'Content-Type': 'application/json'
           },
           type:"POST",
           data:JSON .stringify(newUser),
           url:"/admin/user",
           success:successHander
       });
       event.preventDefault();
   }
   // ve lai
   function successHander(){
       $('#create_modals').modal('hide');
       $('#updateModal').modal('hide');
       $('#delete_Modal').modal('hide');
       $.ajax({
           headers:{
               'Accept': 'application/json',
               'Content-Type': 'application/json'
           },
           type: "GET",
           url: "/admin/user",
           success:function (data){
               let contents='<tr>\n' +
                   '<td>User Name</td>\n'+
                   '<td>Pass Word</td>\n'+
                   '<td>Full Name</td>\n'+
                   '<td>Email</td>\n'+
                   '<td>Phone Number</td>'+
                   '<td>Edit</td>'+
                   '<td>Delete</td>'+
                   '</tr>';
               for (let i=0;i<data.length;i++){
                   contents+=getUser(data[i]);
               }
               document.getElementById('userList').innerHTML=contents;
           }
       })
   }
   function getUser(user){
       return `<tr>
<td>${user.username}</td>
<td>${user.password}</td>
<td>${user.fullName}</td>
<td>${user.email}</td>
<td>${user.phoneNumber}</td>
<td>
    <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#updateModal"
            id="${user.id}" onclick="update(this.id)">
        Edit
    </button>
     <td>
            <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#delete_Modal"
                    id="${user.id}" onclick="deleteUser(this.id)">
                Delete
            </button>
        </td>
</td>
</tr>`
   }
   //cap nhat
   function update(id){
       //hien thi thong tin de chinh
       $.ajax({
           type:"GET",
           url:"/admin/user/" +id,
           success:function (data){
               $('#id_update').val(data.id)
               $('#name_update').val(data.username)
               $('#password_update').val(data.password)
               $('#fullName_update').val(data.fullName)
               $('#email_update').val(data.email)
               $('#phoneNumber_update').val(data.phoneNumber)
           }
       })
       $(document).ready(function (){
           $('#update_button').click(function (event){
               let username=$('#name_update').val()
               let password=$('#password_update').val()
               let fullName=$('#fullName_update').val()
               let email=$('#email_update').val()
               let phoneNumber=$('#phoneNumber_update').val()
               let newUser={
                   username:username,
                   password:password,
                   fullName:fullName,
                   email:email,
                   phoneNumber:phoneNumber
               };
               $.ajax({
                   headers: {
                       'Accept': 'application/json',
                       'Content-Type': 'application/json'
                   },
                   type:"PUT",
                   url:"/admin/user/" +id,
                   data:JSON.stringify(newUser),
                   success:successHander
               })
               event.preventDefault();
           })
       })
   }
   //xoa
   function deleteUser(id){
       $(document).ready(function (){
           $('#delete_button').click(function (event){
               $.ajax({
                   type:"DELETE",
                   url:`/admin/user/`+id,
                   success:successHander
               })
               event.preventDefault();
           })
       })
   }
</script>

<!--//modal create-->
<div class="modal fade" id="create_modals" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="create_modal">CREATE</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div>
                    <input type="hidden" value="${data.id}" id="id_create">
                    <label>User Name</label>
                    <label><input type="text" id="name_create"></label>
                </div>
                <div>
                    <label>Pass Word</label>
                    <label><input type="text" id="password_create"></label>
                </div>
                <div>
                    <label>Full Name</label>
                    <label><input type="text" id="fullName_create"></label>
                </div>
                <div>
                    <label>Email</label>
                    <label><input type="text" id="email_create"></label>
                </div>
                <div>
                    <label>Phone Number</label>
                    <label><input type="text" id="phoneNumber_create"></label>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="create-button" onclick="createUser()">Save</button>
            </div>
        </div>
    </div>
</div>
<!-- Modal update -->
<div class="modal fade" id="updateModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">EDIT</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div>
                    <input type="hidden" value="${data.id}" id="id_update">
                    <label>User Name</label>
                    <label><input type="text" id="name_update"></label>
                </div>
                <div>
                    <label>Pass Word</label>
                    <label><input type="text" id="password_update"></label>
                </div>
                <div>
                    <label>Full Name</label>
                    <label><input type="text" id="fullName_update"></label>
                </div>
                <div>
                    <label>Email</label>
                    <label><input type="text" id="email_update"></label>
                </div>
                <div>
                    <label>Phone Number</label>
                    <label><input type="text" id="phoneNumber_update"></label>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="update_button">Update</button>
            </div>
        </div>
    </div>
</div>
<!--modal delete-->
<div class="modal fade" id="delete_Modal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="eModalLabel">DELETE</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <td>Do you want delete</td>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="delete_button">Yes</button>
            </div>
        </div>
    </div>
</div>
</body>
</html>